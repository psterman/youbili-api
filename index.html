<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouBili - YouTube和B站视频下载助手</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <h1>YouBili 视频下载助手</h1>
        <p class="subtitle">支持 YouTube 和 B站 视频下载</p>

        <div class="input-group">
            <input type="text" id="videoUrl" placeholder="请输入YouTube或B站视频链接..." class="url-input">
            <button onclick="getVideoInfo()" class="submit-btn">获取下载链接</button>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>正在获取视频信息...</p>
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="videoInfo" class="video-info" style="display: none;">
            <div class="video-header">
                <img id="thumbnail" class="thumbnail" src="" alt="视频缩略图">
                <div class="video-details">
                    <h2 id="videoTitle"></h2>
                    <p id="videoUploader"></p>
                </div>
            </div>

            <div class="download-options">
                <h3>下载选项</h3>
                <div class="download-tip">
                    <p>下载说明：</p>
                    <ul>
                        <li>点击下载按钮后会跳转到对应的下载页面</li>
                        <li>如果一个链接无法下载，请尝试其他链接</li>
                        <li>建议从高到低依次尝试不同清晰度</li>
                    </ul>
                </div>
                <div id="downloadLinks" class="download-links"></div>
            </div>
        </div>
    </div>

    <script>
        async function getVideoInfo() {
            const urlInput = document.getElementById('videoUrl');
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const videoInfoDiv = document.getElementById('videoInfo');
            const downloadLinksDiv = document.getElementById('downloadLinks');

            // 重置显示状态
            loadingDiv.style.display = 'flex';
            errorDiv.style.display = 'none';
            videoInfoDiv.style.display = 'none';
            downloadLinksDiv.innerHTML = '';

            try {
                const response = await fetch(`https://youbili-api.vercel.app/api/video-info?url=${encodeURIComponent(urlInput.value)}`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                // 显示视频信息
                document.getElementById('thumbnail').src = data.thumbnail;
                document.getElementById('videoTitle').textContent = data.title;
                document.getElementById('videoUploader').textContent = `上传者: ${data.uploader}`;

                // 创建下载选项
                data.formats.forEach(format => {
                    const downloadOption = document.createElement('div');
                    downloadOption.className = 'download-option';

                    const qualityLabel = document.createElement('div');
                    qualityLabel.className = 'quality-label';
                    qualityLabel.innerHTML = `
                        <span class="quality">${format.quality}</span>
                        <span class="format">${format.format}</span>
                        <span class="size">${format.size}</span>
                    `;

                    const downloadButton = document.createElement('a');
                    downloadButton.href = format.url;
                    downloadButton.className = 'download-btn';
                    downloadButton.target = '_blank';
                    downloadButton.innerHTML = '<span>下载</span>';

                    downloadOption.appendChild(qualityLabel);
                    downloadOption.appendChild(downloadButton);
                    downloadLinksDiv.appendChild(downloadOption);
                });

                // 如果有提示消息，显示它
                if (data.message) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'notification info';
                    messageDiv.textContent = data.message;
                    downloadLinksDiv.insertBefore(messageDiv, downloadLinksDiv.firstChild);
                }

                videoInfoDiv.style.display = 'block';
            } catch (error) {
                errorDiv.textContent = error.message || '获取视频信息失败，请稍后重试';
                errorDiv.style.display = 'block';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }
    </script>
</body>

</html>